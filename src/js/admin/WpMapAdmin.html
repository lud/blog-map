<div class="wpmap-admin">
    {#await $initialLoading}
        Loading ...
        <LoadingSpinner/>
    {:then _}
        <p>{$mapConfig.name} <code>{$mapID}</code></p>
        {#if $posts.length === 0}
            <p>No post available</p>
        {:else}
            <WpMapPostList/>
        {/if}
        <CountriesDatalist/>
        <!-- <pre>{JSON.stringify($mapConfig, 0, '  ')}</pre> -->

        <WpMap ref:map mapID={$mapID} config={$mapConfig}/>
        <PinDesigner on:change="$actSetPinConfig(event)" height={$mapConfig.pin_config.height} radius={$mapConfig.pin_config.radius} fillColor={$mapConfig.pin_config.fillColor} strokeColor={$mapConfig.pin_config.strokeColor} />
    {:catch error}
        NotLoaded !
        <p class="error">Error loading plugin</p>
    {/await}
</div>

<script>
import WpMapPostList from './WpMapPostList.html'
import LoadingSpinner from './wp/LoadingSpinner.html'
import CountriesDatalist from './wp/CountriesDatalist.html'
import PinDesigner from './wp/PinDesigner.html'
import WpMap from './../client/WpMap.html'

export default {
  components: {
    WpMapPostList,
    LoadingSpinner,
    CountriesDatalist,
    WpMap,
    PinDesigner
  },
  oncreate() {
  	this.store.on('refreshMap', () => {
  		this.refs.map.fetch()
  	})
  }
}
</script>
