<div class="wpmap-admin-posts-list">
  <ul>
    {#each $posts as post}
        <li class="map-status-{postMapStatus(post)}">
            <h4 class="map-status-bg">
                {#if post.props.type !== 'post'}
                    <span>[{post.props.type}]</span>
                {/if}
                {post.props.title}
            </h4>
            <VisibilitySwitch
                checked="{post.layer.visible}"
                on="{WPMAP_VIS_ONMAP}"
                off="{WPMAP_VIS_NOTONMAP}"
                on:change="$actTogglePostVisibilities(post._id, event)"/>
            <span class="{postStatusClass(post.props.status)}">{post.props.status}</span>
            <CountryPicker
                value="{post.meta.wpmap_country_alpha2}"
                on:change="$actSetPostCountryCode(post._id, event)"/>
            <Geocoder
                countryAlpha2={post.meta.wpmap_country_alpha2}
                defaultDisplay={post.meta.wpmap_geocoded}
                on:change="$actSetPostGeocoding(post._id, event)"/>
            <span>
                <i class="fa fa-{post.layer.icon}"></i>
                <input
                    type="text"
                    size="7"
                    value="{post.layer.icon}"
                    on:change="$actSetPostIcon(post._id, this.value)"/>
            </span>

        </li>
    {/each}
    </ul>
</div>

<script>

import VisibilitySwitch from './wp/VisibilitySwitch.html'
import CountryPicker from './wp/CountryPicker.html'
import Geocoder from './wp/Geocoder.html'

const WPMAP_VIS_ONMAP = 1 // Show on map
const WPMAP_VIS_NOTONMAP = 0 // Do not show on map

export default {
    immutable: true,
    data() {
        return {
            WPMAP_VIS_ONMAP,
            WPMAP_VIS_NOTONMAP
        }
    },
    components: { VisibilitySwitch, CountryPicker, Geocoder },
    helpers: {
        postMapStatus: post => {
            // show if a post is ok to be on the map. If the post is NOT set to
            // be on the map, we just reurn 'none'
            if (post.layer.visible) {
                const isOK = Array.isArray(post.meta.wpmap_latlng)
                          && 'publish' === post.props.status
                return isOK ? 'ok' : 'error'
            }
            return 'none';
        },
        postStatusClass: status => {
            return 'map-status-poststatus-' + ((status === 'publish') ? 'ok' : 'error')
        }
    }
}

</script>

<style>
    h4 {
        margin: 0;
    }
    .map-status-error .map-status-bg {
        background-color: #fcc;
    }
    .map-status-ok .map-status-bg {
        background-color: #cfc;
    }
    .map-status-error .map-status-poststatus-error {
        background-color: #fcc;
    }
    .wpmap-admin-posts-list li {
        margin-bottom: 1em;
    }
</style>
