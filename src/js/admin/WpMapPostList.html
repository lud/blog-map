<div class="wpmap-admin-posts-list">
    <table>
    <tr>
        <th>#</th>
        <th>Title</th>
        <th>Type</th>
        <th>Status</th>
        <!-- <th>Vis</th> -->
        <th>Visible</th>
        <th>Country</th>
        <th>Location</th>
    </tr>
    {#each $posts as post}
        <tr class="wpmap-admin-posts-list-item map-status-{postMapStatus(post)}">

            <td class="map-status-bg">{post._id}</td>
            <td>{post.props.title}</td>
            <td>{post.props.type}</td>
            <td>{post.props.status}</td>
            <!-- <td>{JSON.stringify(post.meta.wpmap_visibilities)}</td> -->
            <td>
                {JSON.stringify(post.layer)}

                <ToggleSwitch
                    checked="{post.layer.visible}"
                    on="{WPMAP_VIS_ONMAP}"
                    off="{WPMAP_VIS_NOTONMAP}"
                    on:change="$actTogglePostVisibilities(post._id, event)"/>
            </td>
            <td>
                <CountryPicker
                    value="{post.meta.wpmap_country_alpha2}"
                    on:change="$actSetPostCountryCode(post._id, event)"/>
            </td>
            <td style="position:relative">
                <Geocoder
                    countryAlpha2={post.meta.wpmap_country_alpha2}
                    defaultDisplay={post.meta.wpmap_geocoded}
                    on:change="$actSetPostGeocoding(post._id, event)"/>
            </td>
            <td>{post.meta.wpmap_latlng}</td>
        </tr>
    {/each}
    </table>
</div>

<script>

import ToggleSwitch from './wp/ToggleSwitch.html'
import CountryPicker from './wp/CountryPicker.html'
import Geocoder from './wp/Geocoder.html'

const WPMAP_VIS_ONMAP = 1 // Show on map
const WPMAP_VIS_NOTONMAP = 0 // Do not show on map

export default {
    immutable: true,
    data() {
        return {
            WPMAP_VIS_ONMAP,
            WPMAP_VIS_NOTONMAP
        }
    },
    components: { ToggleSwitch, CountryPicker, Geocoder },
    helpers: {
        postMapStatus: post => {
            // show if a post is ok to be on the map. If the post is set to
            // be on the map, the only thing required is coordinates
            // If not on the map, we return default status (with no style)
            if (post.layer.visible) {
                return Array.isArray(post.meta.wpmap_latlng) ? 'ok' : 'error'
            }
            return 'none';
        }
    }
}

</script>

<style>
    th {
        text-align: left;
    }
    th:first-child, td:first-child {
        text-align: right;
        font-family: monospace;
    }
    .map-status-error .map-status-bg {
        background-color: #fcc;
    }
    .map-status-ok .map-status-bg {
        background-color: #cfc;
    }
</style>
