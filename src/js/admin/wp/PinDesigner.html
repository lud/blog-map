<div>
  <div>
    <label>
      <span>Size</span>
      <input type="range" bind:value=height min="{minimumHeight}" max="{maximumHeight}" on:change="fixAndFire()" />
      <span>{height}px</span>
    </label>
    <br/>
    <label>
      <span>Shape</span>
      <input type="range" bind:value=radius min="{minimumRadius}" max="{maximumRadius}" on:change="fixAndFire()" />
    </label>
    <br/>
    <label>
      <span>Default Fill Color</span>
      <input type="color" bind:value=fillColor />
      <code>{fillColor}</code>
    </label>
    <br/>
    <label>
      <span>Default Sroke Color</span>
      <input type="color" bind:value=strokeColor />
      <code>{strokeColor}</code>
    </label>
  </div>
  <div>
    <svg style="height: {height + strokeWidth * 2}px; width: {radius * 2 + strokeWidth * 2};" viewBox="{viewBox}">
      <path d="{path}" stroke-width="{strokeWidth}" stroke="{strokeColor}" fill="{fillColor}"></path>
    </svg>
  </div>

</div>
<script>
    import { pinPath, pinViewBox } from '../../helpers/map-pins'
    export default {
        data() {
            return {
              fillColor: '#7babdf',
              strokeColor: '#0088aa',
              strokeWidth: 1,
              minimumRadius: 7,
              minimumHeight: 16,
              maximumHeight: 70,
            }
        },
        computed: {
          maximumRadius: ({ height }) => Math.floor(height / 2) - 1,
          viewBox: ({ radius, height, strokeWidth }) => pinViewBox(radius, height, strokeWidth),
          path: ({ radius, height }) => pinPath(radius, height),
        },
        oncreate() {
          this.on('state', ({ changed, current, previous }) => {
            // if the height changes, we want to keep the same shape, so we
            // change the radius accordingly
            if (changed.height) {
              const heightChangeRatio = current.height / previous.height
              const newRadius = current.radius * heightChangeRatio
              this.set({ radius: newRadius })
            }
          })
        },
        methods: {
          fixAndFire() {
            let { height, radius, fillColor, strokeColor } = this.get()
            height = Math.round(height)
            if (radius * 2 >= height) {
              radius = height / 2 - 1
            }
            radius = Math.round(radius)
            this.set({ height, radius })
            console.log('fire change { height: %s, radius: %s }', height, radius)
            this.fire('change', { height, radius, fillColor, strokeColor })
          }
        }
    }
</script>

